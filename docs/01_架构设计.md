# 架构设计 | 总纲

## 项目概览

**项目名称**: Modbus 仿真器  
**开发方式**: 纯AI辅助开发  
**部署方式**: 本地部署，单一可执行文件  

## 技术栈

### 后端技术
- **.NET 8**: 后端框架，支持跨平台部署
- **ASP.NET Core**: HTTP API服务
- **Kestrel**: 内置Web服务器
- **SQLite**: 轻量级本地数据库
- **Dapper**: 轻量级ORM，数据访问层

### 前端技术  
- **Next.js**: React全栈框架
- **TypeScript**: 类型安全的JavaScript
- **Tailwind CSS**: 工具优先的CSS框架
- **React Hook Form**: 表单管理
- **SWR**: 数据获取和缓存

### 协议支持
- **Modbus TCP**: 标准以太网Modbus协议
- **Modbus RTU over TCP**: TCP封装的RTU协议

## 系统架构

### 整体架构图
```
┌─────────────────────────────────────┐
│              前端层                  │
│         Next.js + React            │
│     TypeScript + Tailwind CSS     │
└─────────────────┬───────────────────┘
                  │ HTTP API
┌─────────────────┴───────────────────┐
│              后端层                  │
│         ASP.NET Core API           │
├─────────────────────────────────────┤
│           业务服务层                  │
│ ConnectionService | ModbusService   │
│   SlaveService | RegisterService    │
├─────────────────────────────────────┤
│           数据访问层                  │
│        Repository + Dapper         │
├─────────────────────────────────────┤
│           数据存储层                  │
│             SQLite                 │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│            TCP服务层                 │
│      Modbus协议仿真服务              │
└─────────────────────────────────────┘
```

### 数据流架构
```
Web前端 ←→ HTTP API ←→ 业务服务 ←→ 数据访问层 ←→ SQLite
                          ↓
                   TCP服务 ←→ Modbus客户端
```

## 核心模块

### 1. Web前端
- **设备树管理**: 分层展示连接、从机、寄存器
- **配置界面**: 可视化配置管理
- **数据管理**: 寄存器数据编辑和展示

### 2. HTTP API
- **RESTful接口**: 标准REST API设计
- **CRUD操作**: 连接、从机、寄存器管理
- **数据验证**: 请求参数校验和错误处理

### 3. TCP服务
- **多端口监听**: 支持同时监听多个端口
- **自动端口分配**: 新增连接时自动分配端口（从502开始递增）
- **协议仿真**: 实现Modbus读操作（功能码01-04），不支持写操作
- **并发处理**: 支持多客户端同时连接

### 4. 数据层
- **三层数据结构**: connections → slaves → registers
- **外键关联**: 确保数据一致性
- **事务支持**: 保证数据操作原子性

## 部署架构

### 开发环境
```
modbus-simulator/          # 后端 .NET 8 项目
modbus-simulator-web/      # 前端 Next.js 项目  
docs/                      # 设计文档
```

### 生产部署
- **后端**: 自包含可执行文件 (Self-contained deployment)
- **前端**: 静态文件部署或内嵌到后端
- **数据库**: SQLite文件本地存储
- **日志**: 结构化日志输出到文件

## 关键特性

### 可扩展性
- 插件化协议支持
- 模块化服务架构
- 配置驱动设计

### 易部署性
- 单文件部署
- 零配置启动
- 跨平台支持

## 总结

整个系统采用前后端分离的现代Web架构，后端专注于API服务和协议仿真，前端专注于用户交互和数据展示。通过轻量级技术栈和模块化设计，实现了高性能、易部署、可扩展的Modbus仿真解决方案。

---

## 📚 文档导航

本项目采用分层架构设计，文档按照系统层次组织：

### 🏗️ 基础设计
- **[02_数据库设计.md](./02_数据库设计.md)** - 数据模型和存储结构
- **[03_API接口规范.md](./03_API接口规范.md)** - HTTP API规范和接口定义

### 🎨 前端设计  
- **[04_前端功能设计.md](./04_前端功能设计.md)** - 用户界面和功能设计

### ⚙️ 后端实现设计
- **[5.1_数据访问层.md](./05_后端实现设计/5.1_数据访问层.md)** - Repository模式和数据访问
- **[5.2_TCP服务端.md](./05_后端实现设计/5.2_TCP服务端.md)** - TCP通信和连接管理  
- **[5.3_Modbus协议仿真.md](./05_后端实现设计/5.3_Modbus协议仿真.md)** - Modbus协议实现

### 📋 文档阅读顺序建议

**架构了解**: 01 → 02 → 03  
**前端开发**: 01 → 03 → 04  
**后端开发**: 01 → 02 → 03 → 5.1 → 5.2 → 5.3  
**运维部署**: 01 → 02
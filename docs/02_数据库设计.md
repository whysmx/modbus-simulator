数据库设计

⏺ -- 连接配置表
  CREATE TABLE connections (
      id TEXT PRIMARY KEY,        -- 32位无横杠UUID
      name TEXT NOT NULL UNIQUE,  -- 连接名称
      port INTEGER NOT NULL UNIQUE -- 端口号（新增连接时自动分配，从502开始递增）
  );

  -- 从机配置表
  CREATE TABLE slaves (
      id TEXT PRIMARY KEY,            -- 32位无横杠UUID
      connid TEXT NOT NULL,          -- 关联连接ID
      name TEXT NOT NULL,             -- 从机名称
      slaveid INTEGER NOT NULL,       -- 从机地址（1-247）

      FOREIGN KEY (connid) REFERENCES connections(id) ON DELETE CASCADE,
      UNIQUE(connid, slaveid),       -- 同连接下从机地址唯一
      UNIQUE(connid, name)           -- 同连接下从机名称唯一
  );

  -- 寄存器数据表
  CREATE TABLE registers (
      id TEXT PRIMARY KEY,            -- 32位无横杠UUID
      slaveid TEXT NOT NULL,         -- 关联从机ID
      startaddr INTEGER NOT NULL,     -- 起始逻辑地址
      hexdata TEXT NOT NULL,          -- 连续寄存器的16进制字符串

      FOREIGN KEY (slaveid) REFERENCES slaves(id) ON DELETE CASCADE,
      UNIQUE(slaveid, startaddr)     -- 同从机下起始地址唯一
  );

  -- 索引
  CREATE INDEX idx_slaves_conn ON slaves(connid);
  CREATE INDEX idx_registers_slave ON registers(slaveid);
  CREATE INDEX idx_registers_addr ON registers(slaveid, startaddr);

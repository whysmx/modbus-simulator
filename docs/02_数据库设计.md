数据库设计

⏺ -- 连接配置表
  CREATE TABLE connections (
      Id TEXT PRIMARY KEY,        -- 32位无横杠UUID
      Name TEXT NOT NULL UNIQUE,  -- 连接名称
      Port INTEGER NOT NULL UNIQUE, -- 端口号（新增连接时自动分配，从502开始递增）
      ProtocolType INTEGER NOT NULL DEFAULT 0 -- 协议类型：0=Modbus RTU Over TCP（默认），1=Modbus TCP
  );

  -- 从机配置表
  CREATE TABLE slaves (
      Id TEXT PRIMARY KEY,            -- 32位无横杠UUID
      ConnId TEXT NOT NULL,          -- 关联连接ID
      Name TEXT NOT NULL,             -- 从机名称
      SlaveId INTEGER NOT NULL,       -- 从机地址（1-247）

      FOREIGN KEY (ConnId) REFERENCES connections(Id) ON DELETE CASCADE,
      UNIQUE(ConnId, SlaveId),       -- 同连接下从机地址唯一
      UNIQUE(ConnId, Name)           -- 同连接下从机名称唯一
  );

  -- 寄存器数据表
  CREATE TABLE registers (
      Id TEXT PRIMARY KEY,            -- 32位无横杠UUID
      SlaveId TEXT NOT NULL,         -- 关联从机ID
      StartAddr INTEGER NOT NULL,     -- 起始逻辑地址
      HexData TEXT NOT NULL,          -- 连续寄存器的16进制字符串

      FOREIGN KEY (SlaveId) REFERENCES slaves(Id) ON DELETE CASCADE,
      UNIQUE(SlaveId, StartAddr)     -- 同从机下起始地址唯一
  );

  -- 索引
  CREATE INDEX idx_slaves_conn ON slaves(ConnId);
  CREATE INDEX idx_registers_slave ON registers(SlaveId);
  CREATE INDEX idx_registers_addr ON registers(SlaveId, StartAddr);
